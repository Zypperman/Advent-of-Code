# test set
nodes = ["0", "1", "2", "3", "4", "5", "6"]

adjlist = {
    "0": ["5", "2"],
    "1": ["3", "6"],
    "2": ["4"],
    "3": ["5"],
    "4": [],
    "5": ["4", "2"],
    "6": ["2"],
}
# """
# actual data
nodes = [
    "61",
    "64",
    "66",
    "41",
    "12",
    "69",
    "86",
    "93",
    "85",
    "38",
    "95",
    "46",
    "39",
    "99",
    "92",
    "81",
    "97",
    "16",
    "23",
]
adjlist_items = [
    (
        "48",
        [
            "39",
            "96",
            "94",
            "45",
            "87",
            "75",
            "95",
            "81",
            "64",
            "66",
            "78",
            "58",
            "97",
            "16",
            "85",
            "72",
            "55",
            "23",
            "31",
            "76",
            "88",
            "99",
            "26",
            "42",
        ],
    ),
    (
        "26",
        [
            "97",
            "94",
            "66",
            "86",
            "61",
            "96",
            "55",
            "23",
            "39",
            "16",
            "46",
            "41",
            "42",
            "58",
            "72",
            "64",
            "12",
            "95",
            "75",
            "99",
            "78",
            "81",
            "85",
            "88",
        ],
    ),
    (
        "76",
        [
            "66",
            "58",
            "88",
            "26",
            "39",
            "81",
            "45",
            "99",
            "87",
            "61",
            "96",
            "78",
            "94",
            "72",
            "42",
            "55",
            "97",
            "85",
            "95",
            "23",
            "64",
            "16",
            "75",
            "31",
        ],
    ),
    (
        "75",
        [
            "61",
            "71",
            "57",
            "74",
            "17",
            "38",
            "11",
            "69",
            "35",
            "93",
            "86",
            "65",
            "92",
            "28",
            "12",
            "41",
            "82",
            "68",
            "62",
            "46",
            "36",
            "64",
            "89",
            "51",
        ],
    ),
    (
        "69",
        [
            "36",
            "89",
            "65",
            "51",
            "96",
            "26",
            "57",
            "48",
            "74",
            "87",
            "71",
            "17",
            "78",
            "31",
            "45",
            "11",
            "76",
            "55",
            "62",
            "68",
            "28",
            "72",
            "35",
            "79",
        ],
    ),
    (
        "62",
        [
            "72",
            "81",
            "79",
            "76",
            "99",
            "65",
            "94",
            "31",
            "58",
            "88",
            "96",
            "45",
            "78",
            "48",
            "95",
            "87",
            "23",
            "85",
            "55",
            "42",
            "16",
            "26",
            "97",
            "66",
        ],
    ),
    (
        "82",
        [
            "62",
            "69",
            "92",
            "57",
            "35",
            "87",
            "89",
            "17",
            "26",
            "74",
            "36",
            "48",
            "31",
            "11",
            "79",
            "96",
            "93",
            "68",
            "28",
            "51",
            "65",
            "71",
            "76",
            "45",
        ],
    ),
    (
        "28",
        [
            "72",
            "35",
            "79",
            "78",
            "66",
            "26",
            "68",
            "31",
            "58",
            "87",
            "55",
            "11",
            "42",
            "65",
            "23",
            "62",
            "16",
            "45",
            "97",
            "96",
            "76",
            "17",
            "48",
            "88",
        ],
    ),
    (
        "16",
        [
            "61",
            "12",
            "99",
            "46",
            "82",
            "38",
            "51",
            "75",
            "85",
            "23",
            "41",
            "81",
            "42",
            "86",
            "92",
            "74",
            "93",
            "64",
            "71",
            "95",
            "94",
            "97",
            "39",
            "69",
        ],
    ),
    (
        "39",
        [
            "38",
            "86",
            "57",
            "74",
            "35",
            "64",
            "89",
            "68",
            "36",
            "46",
            "11",
            "41",
            "17",
            "75",
            "93",
            "82",
            "28",
            "71",
            "69",
            "12",
            "92",
            "51",
            "61",
            "62",
        ],
    ),
    (
        "36",
        [
            "65",
            "48",
            "42",
            "55",
            "35",
            "76",
            "17",
            "62",
            "87",
            "57",
            "16",
            "11",
            "96",
            "88",
            "45",
            "31",
            "78",
            "58",
            "26",
            "66",
            "68",
            "28",
            "79",
            "72",
        ],
    ),
    (
        "35",
        [
            "94",
            "85",
            "97",
            "76",
            "26",
            "23",
            "48",
            "87",
            "58",
            "65",
            "78",
            "42",
            "99",
            "79",
            "55",
            "16",
            "96",
            "88",
            "66",
            "45",
            "72",
            "31",
            "62",
            "81",
        ],
    ),
    (
        "81",
        [
            "86",
            "89",
            "75",
            "93",
            "51",
            "71",
            "17",
            "57",
            "12",
            "41",
            "82",
            "64",
            "39",
            "36",
            "92",
            "69",
            "61",
            "11",
            "28",
            "74",
            "95",
            "46",
            "85",
            "38",
        ],
    ),
    (
        "88",
        [
            "46",
            "42",
            "97",
            "92",
            "93",
            "38",
            "66",
            "12",
            "16",
            "95",
            "75",
            "69",
            "82",
            "41",
            "94",
            "81",
            "39",
            "86",
            "85",
            "61",
            "64",
            "23",
            "99",
            "58",
        ],
    ),
    (
        "11",
        [
            "65",
            "62",
            "35",
            "76",
            "88",
            "58",
            "26",
            "17",
            "66",
            "94",
            "68",
            "16",
            "42",
            "45",
            "79",
            "97",
            "87",
            "78",
            "72",
            "23",
            "48",
            "31",
            "55",
            "96",
        ],
    ),
    (
        "95",
        [
            "57",
            "86",
            "82",
            "39",
            "69",
            "35",
            "17",
            "61",
            "68",
            "46",
            "41",
            "38",
            "74",
            "36",
            "51",
            "11",
            "28",
            "93",
            "92",
            "12",
            "64",
            "71",
            "89",
            "75",
        ],
    ),
    (
        "85",
        [
            "89",
            "75",
            "51",
            "68",
            "28",
            "95",
            "41",
            "57",
            "12",
            "11",
            "64",
            "74",
            "71",
            "36",
            "38",
            "82",
            "61",
            "46",
            "69",
            "86",
            "92",
            "39",
            "17",
            "93",
        ],
    ),
    (
        "97",
        [
            "81",
            "61",
            "23",
            "85",
            "69",
            "93",
            "64",
            "95",
            "89",
            "46",
            "12",
            "82",
            "36",
            "51",
            "92",
            "74",
            "75",
            "38",
            "41",
            "94",
            "71",
            "39",
            "86",
            "99",
        ],
    ),
    (
        "61",
        [
            "17",
            "79",
            "89",
            "86",
            "68",
            "41",
            "46",
            "71",
            "51",
            "12",
            "11",
            "28",
            "93",
            "36",
            "92",
            "65",
            "38",
            "62",
            "82",
            "48",
            "74",
            "57",
            "35",
            "69",
        ],
    ),
    (
        "79",
        [
            "85",
            "26",
            "48",
            "87",
            "31",
            "66",
            "55",
            "39",
            "94",
            "88",
            "99",
            "95",
            "75",
            "76",
            "97",
            "96",
            "81",
            "45",
            "16",
            "23",
            "72",
            "58",
            "42",
            "78",
        ],
    ),
    (
        "74",
        [
            "11",
            "57",
            "26",
            "79",
            "28",
            "71",
            "55",
            "17",
            "51",
            "89",
            "88",
            "96",
            "72",
            "36",
            "62",
            "68",
            "48",
            "31",
            "76",
            "45",
            "78",
            "87",
            "35",
            "65",
        ],
    ),
    (
        "57",
        [
            "68",
            "58",
            "97",
            "28",
            "42",
            "96",
            "76",
            "11",
            "65",
            "72",
            "17",
            "45",
            "62",
            "79",
            "35",
            "31",
            "16",
            "87",
            "66",
            "88",
            "26",
            "55",
            "78",
            "48",
        ],
    ),
    (
        "12",
        [
            "38",
            "92",
            "93",
            "57",
            "82",
            "45",
            "76",
            "36",
            "11",
            "74",
            "51",
            "41",
            "35",
            "71",
            "79",
            "17",
            "62",
            "89",
            "28",
            "48",
            "86",
            "69",
            "68",
            "65",
        ],
    ),
    (
        "99",
        [
            "69",
            "74",
            "92",
            "82",
            "39",
            "46",
            "28",
            "11",
            "86",
            "57",
            "85",
            "12",
            "71",
            "75",
            "41",
            "64",
            "89",
            "81",
            "93",
            "95",
            "36",
            "51",
            "38",
            "61",
        ],
    ),
    (
        "38",
        [
            "62",
            "79",
            "65",
            "28",
            "68",
            "48",
            "35",
            "74",
            "71",
            "31",
            "36",
            "93",
            "76",
            "26",
            "51",
            "92",
            "45",
            "69",
            "17",
            "89",
            "11",
            "82",
            "57",
            "87",
        ],
    ),
    (
        "89",
        [
            "31",
            "36",
            "45",
            "66",
            "62",
            "76",
            "55",
            "65",
            "26",
            "79",
            "96",
            "16",
            "87",
            "58",
            "11",
            "78",
            "57",
            "68",
            "88",
            "35",
            "17",
            "28",
            "48",
            "72",
        ],
    ),
    (
        "55",
        [
            "46",
            "86",
            "12",
            "75",
            "95",
            "41",
            "61",
            "42",
            "23",
            "94",
            "93",
            "81",
            "39",
            "99",
            "64",
            "85",
            "16",
            "88",
            "72",
            "66",
            "97",
            "38",
            "58",
            "82",
        ],
    ),
    (
        "51",
        [
            "11",
            "36",
            "58",
            "55",
            "76",
            "26",
            "79",
            "28",
            "78",
            "68",
            "96",
            "48",
            "31",
            "65",
            "87",
            "35",
            "62",
            "88",
            "45",
            "72",
            "71",
            "17",
            "89",
            "57",
        ],
    ),
    (
        "92",
        [
            "55",
            "87",
            "31",
            "76",
            "74",
            "17",
            "48",
            "68",
            "57",
            "96",
            "11",
            "65",
            "69",
            "26",
            "28",
            "51",
            "89",
            "79",
            "35",
            "36",
            "45",
            "71",
            "78",
            "62",
        ],
    ),
    (
        "41",
        [
            "82",
            "76",
            "71",
            "48",
            "57",
            "74",
            "65",
            "89",
            "86",
            "17",
            "79",
            "11",
            "35",
            "93",
            "62",
            "38",
            "45",
            "36",
            "31",
            "68",
            "51",
            "92",
            "28",
            "69",
        ],
    ),
    (
        "65",
        [
            "99",
            "55",
            "88",
            "48",
            "81",
            "85",
            "72",
            "31",
            "26",
            "39",
            "42",
            "58",
            "78",
            "87",
            "97",
            "16",
            "96",
            "23",
            "95",
            "66",
            "79",
            "76",
            "45",
            "94",
        ],
    ),
    (
        "17",
        [
            "96",
            "94",
            "48",
            "26",
            "88",
            "87",
            "68",
            "35",
            "65",
            "72",
            "31",
            "16",
            "97",
            "23",
            "58",
            "79",
            "55",
            "66",
            "78",
            "42",
            "45",
            "62",
            "99",
            "76",
        ],
    ),
    (
        "78",
        [
            "61",
            "75",
            "58",
            "85",
            "97",
            "88",
            "82",
            "81",
            "99",
            "42",
            "16",
            "23",
            "95",
            "38",
            "41",
            "39",
            "86",
            "55",
            "46",
            "64",
            "66",
            "72",
            "12",
            "94",
        ],
    ),
    (
        "68",
        [
            "31",
            "79",
            "97",
            "87",
            "23",
            "55",
            "99",
            "26",
            "94",
            "66",
            "81",
            "42",
            "16",
            "58",
            "62",
            "72",
            "96",
            "78",
            "45",
            "76",
            "88",
            "48",
            "65",
            "35",
        ],
    ),
    (
        "45",
        [
            "96",
            "55",
            "61",
            "85",
            "99",
            "81",
            "72",
            "39",
            "78",
            "75",
            "87",
            "66",
            "23",
            "16",
            "58",
            "97",
            "94",
            "26",
            "31",
            "46",
            "88",
            "64",
            "95",
            "42",
        ],
    ),
    (
        "66",
        [
            "92",
            "12",
            "16",
            "75",
            "85",
            "42",
            "93",
            "94",
            "69",
            "82",
            "74",
            "97",
            "86",
            "46",
            "38",
            "61",
            "23",
            "64",
            "95",
            "99",
            "41",
            "51",
            "81",
            "39",
        ],
    ),
    (
        "96",
        [
            "95",
            "94",
            "64",
            "58",
            "97",
            "81",
            "46",
            "72",
            "78",
            "23",
            "16",
            "88",
            "39",
            "55",
            "41",
            "75",
            "38",
            "12",
            "66",
            "99",
            "42",
            "61",
            "86",
            "85",
        ],
    ),
    (
        "93",
        [
            "74",
            "78",
            "87",
            "11",
            "71",
            "57",
            "45",
            "28",
            "48",
            "69",
            "65",
            "92",
            "17",
            "35",
            "51",
            "26",
            "89",
            "31",
            "68",
            "79",
            "62",
            "96",
            "76",
            "36",
        ],
    ),
    (
        "42",
        [
            "97",
            "92",
            "95",
            "38",
            "94",
            "82",
            "89",
            "85",
            "86",
            "69",
            "71",
            "81",
            "12",
            "23",
            "99",
            "74",
            "41",
            "64",
            "51",
            "61",
            "93",
            "75",
            "39",
            "46",
        ],
    ),
    (
        "31",
        [
            "23",
            "26",
            "75",
            "64",
            "87",
            "88",
            "16",
            "96",
            "42",
            "85",
            "46",
            "72",
            "12",
            "61",
            "95",
            "97",
            "78",
            "58",
            "66",
            "99",
            "55",
            "94",
            "39",
            "81",
        ],
    ),
    (
        "23",
        [
            "64",
            "39",
            "99",
            "57",
            "46",
            "82",
            "61",
            "81",
            "95",
            "85",
            "74",
            "89",
            "41",
            "12",
            "71",
            "92",
            "38",
            "86",
            "69",
            "51",
            "94",
            "93",
            "36",
            "75",
        ],
    ),
    (
        "86",
        [
            "68",
            "62",
            "57",
            "35",
            "31",
            "17",
            "51",
            "28",
            "45",
            "36",
            "76",
            "65",
            "74",
            "89",
            "71",
            "82",
            "69",
            "93",
            "48",
            "87",
            "11",
            "92",
            "79",
            "38",
        ],
    ),
    (
        "71",
        [
            "72",
            "68",
            "79",
            "45",
            "26",
            "57",
            "87",
            "48",
            "88",
            "78",
            "17",
            "89",
            "76",
            "96",
            "55",
            "11",
            "62",
            "58",
            "66",
            "36",
            "28",
            "31",
            "65",
            "35",
        ],
    ),
    (
        "58",
        [
            "39",
            "82",
            "16",
            "46",
            "38",
            "69",
            "12",
            "95",
            "86",
            "97",
            "42",
            "41",
            "66",
            "23",
            "74",
            "93",
            "99",
            "75",
            "92",
            "61",
            "81",
            "85",
            "94",
            "64",
        ],
    ),
    (
        "87",
        [
            "41",
            "42",
            "61",
            "66",
            "16",
            "99",
            "46",
            "58",
            "75",
            "96",
            "39",
            "78",
            "94",
            "97",
            "55",
            "85",
            "23",
            "95",
            "88",
            "72",
            "81",
            "26",
            "64",
            "12",
        ],
    ),
    (
        "64",
        [
            "57",
            "61",
            "41",
            "36",
            "51",
            "46",
            "12",
            "86",
            "68",
            "38",
            "93",
            "11",
            "35",
            "74",
            "69",
            "28",
            "17",
            "65",
            "89",
            "71",
            "82",
            "79",
            "92",
            "62",
        ],
    ),
    (
        "46",
        [
            "65",
            "69",
            "48",
            "38",
            "28",
            "17",
            "51",
            "79",
            "74",
            "62",
            "11",
            "36",
            "68",
            "71",
            "35",
            "41",
            "82",
            "93",
            "89",
            "86",
            "92",
            "76",
            "12",
            "57",
        ],
    ),
    (
        "72",
        [
            "58",
            "38",
            "39",
            "85",
            "23",
            "46",
            "99",
            "66",
            "81",
            "42",
            "82",
            "41",
            "86",
            "93",
            "94",
            "16",
            "75",
            "12",
            "97",
            "64",
            "88",
            "92",
            "61",
            "95",
        ],
    ),
    (
        "94",
        [
            "86",
            "46",
            "12",
            "71",
            "89",
            "74",
            "93",
            "75",
            "57",
            "85",
            "64",
            "36",
            "39",
            "81",
            "99",
            "41",
            "69",
            "28",
            "38",
            "95",
            "61",
            "51",
            "92",
            "82",
        ],
    ),
]

adjlist = {}
for i in adjlist_items:
    adjlist[i[0]] = i[1]
# """


def rev_toposort(nodes, adjlist):
    # does dfs on all nodes, reverses them
    # add elements with no outgoing edges first

    print("original")
    print(nodes)
    fully_travelled = []

    for node in nodes:
        print("=" * 15)
        print(f"current node: {node}")

        if node in fully_travelled:
            print(f"node in final set alr, at index {fully_travelled.index(node)}")
            continue

        print("start dfs")

        stack = [node]
        final_len = len(fully_travelled)
        while stack:
            print()
            print("stack state")
            print(stack)
            target = stack[-1]
            print("target:", target)

            if target in fully_travelled:
                print("target in final set alr, at index", fully_travelled.index(target))
                stack.pop()
                continue
            
            if target not in adjlist.keys():
                print("end of a dfs or just no neighbours, can just add")
                fully_travelled.append(stack.pop())
                continue

            exhausted = True

            print("possible neighbours:")
            print(adjlist[target])
            print("neighbours in nodes:")
            print(list(set(adjlist[target]) & set(nodes)))

            for neighbour in adjlist[target]:
                if neighbour in nodes and neighbour not in fully_travelled:
                    exhausted = False
                    stack.append(neighbour)

            if exhausted:
                print("end of dfs, backtracking")
                fully_travelled.append(stack.pop())

            if final_len < len(fully_travelled):
                print()
                final_len = len(fully_travelled)
                print(fully_travelled)

            print()
            print("*" * 20)
            print("FINAL CHECK ON ADDED ITEMS")
            final = fully_travelled[::-1]
            print(final)
            print()

            for i in final:
                failed2 = False
                # print(f"check for {i}")
                self_index = final.index(i)

                if i not in adjlist.keys():
                    # print("no restrictions")
                    continue
                for j in adjlist[i]:
                    if j in final:
                        # print(f"j ({j}) is in {page}")
                        target_index = final.index(str(j))
                    else:
                        target_index = len(final)
                    if target_index < self_index:
                        failed2 = True
                        break
                if failed2 == True:
                    print("order failed")
                    print("item", i, "failed with ruleset")
                    print(adjlist[i])
                    print("FAILED")
                    exit()
                else:
                    print("shit's ok, move along")
                    print("*" * 20)

    print()
    print("final:")
    print(fully_travelled[::-1])

    return fully_travelled[::-1]


print(",".join(rev_toposort(nodes, adjlist)))
